<div class="container-card">
  <div class="card">
    <div class="card-body">
      <h4 class="card-title">Portfolio</h4>
      <h6 class="card-subtitle mb-2 text-muted"><p class="text-warning"><%=message%></p></h6>

  <div><%=portfolio.portfolioname%></div>

  <table class="table table-hover">
    <thead>
      <tr>
        <th scope="col"><small>Symbol</small></th>
        <th scope="col"><small>Value/Cost</small></th>
        <th scope="col"><small>Total Value</small></th>
        <th scope="col"><small>All Time Return</small></th>
        <th scope="col"><small>Day Change</small></th>
        <th scope="col"><small>Day Change(%)</small></th>
      </tr>
    </thead>
    <tbody>
      <% let grandTotal = 0 %>      
      <% let grandReturnTotal = 0 %>
      <% const dollarUSLocale = new Intl.NumberFormat('en-US',{style:'currency',currency:'USD',minimumFractionDigits:2}) %> 
      <% portfolio.stonks.forEach(element => { %>
      <% let totalValue = element.quotes.c * element.qty %>
      <% let totalReturn = totalValue - (element.qty * element.averageCost) %>
      <% grandTotal += totalValue %>
      <% grandReturnTotal += totalReturn %>
      <tr>
        <td>
          <p><small><a href="/company/<%=element.symbol%>"><strong><%=element.symbol%></strong><br />
          <small><%=element.stonkName%></small></a></small></p>
        </td>
        <td style="text-align: right;">
          <p>
            <small><strong><%=dollarUSLocale.format(element.quotes.c)%></strong></small><br />
            <small><small><%=(element.qty)%> @ <%=dollarUSLocale.format(element.averageCost)%></small></small>
          </p>
        </td>
        <td style="text-align: right;">
         <p>
            <small>
            <strong><%=dollarUSLocale.format(totalValue)%></strong>
          </small>
          </p>
        </td>
        <td style="text-align: right;">
          <% if(totalReturn < 0) {%> 
            <p class="text-danger">
          <% } else { %> 
            <p class="text-success">
              <%}%>
          <small>            
            <strong><%=dollarUSLocale.format(totalReturn)%></strong>
          </small>
          </p>
        </td>
        <td style="text-align: right;">
          
          <% if(element.quotes.d < 0){ %>
            <p class="badge bg-danger">
          <%}else{%>
            <p class="badge bg-success">
          <%}%>
          <small>
          <%=element.quotes.d%>
          </small>
          </p>
        </td>
        <td style="text-align: right;">
          <% if(element.quotes.dp < 0){ %>
            <p class="badge bg-danger">
          <%}else{%>
            <p class="badge bg-success">
          <%}%>
          <small>
          <%=element.quotes.dp%></small></p>
        </td>
      </tr>
      <% }) %>
      <tr>
        <th scope="row"><small>Totals</small></th>
        <td>&nbsp;</td>
        <td style="text-align: right;"><small><strong><%=dollarUSLocale.format(grandTotal)%></strong></small></td>
        <td style="text-align: right;">
          <% if(grandReturnTotal < 0) {%> 
            <p class="text-danger">
          <% } else { %> 
            <p class="text-success">
              <%}%>
          <small><strong><%=dollarUSLocale.format(grandReturnTotal)%></strong></small></p></td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
    </tbody>
  </table>
</div>
</div>
</div>